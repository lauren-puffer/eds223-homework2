---
title: "Exploring patterns of environmental injustice"
author: "Lauren Puffer"
format: html
editor: visual
embed-resources: true
page-loading: false
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---

## Introduction

## Data sources

**EJ SCREEN**\
EPA, 2024, "Environmental Justice Mapping and Screening Tool (EJScreen)", <https://doi.org/10.7910/DVN/RLR5AX>, Harvard Dataverse, V4, UNF:6:Ew64oHBMGoTrNkLoYBJcUw== \[fileUNF\]

link to EJ Screen: <https://pedp-ejscreen.azurewebsites.net/>

**HOLC Red lining data**

<https://dsl.richmond.edu/panorama/redlining/data>

**Global Biodiversity Information Facility**

eBird: <https://www.gbif.org/dataset/4fa7b334-ce0d-4e88-aaae-2e0c138d049e>

## Load packages

```{r}
library(tidyverse)
library(sf)
library(tmap)
library(here)
library(tigris) # for shape file of counties
library(janitor) # to clean column names
```

## Bring in data

### Los Angeles County block group levels

EJ SCREEEN uses block groups to asses indicators of environmental justice. We will first need to pull the geometries of the block from EJ SCREEN data. Each block has a unique OBJECTID, which will provide the level of resolution required for this analysis.

```{r}
# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- st_read(here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))

# filter for LA County
ej_screen_la <- ejscreen |>
  filter(CNTY_NAME == "Los Angeles County")

# check to see what the census blocks look like
la_county_blocks_map <- tm_shape(ej_screen_la)+
  tm_polygons()+
  tm_title(text = "Map of LA County Census Block")+
      tm_compass(type = "arrow",
               position = c("left", "bottom"),
               size = 1.5) +
    tm_scalebar(position = c("right", "bottom"), 
                width = 6)

la_county_blocks_map
```

### Shape of Los Angeles

```{r}
# get geometry of CA counties 
ca <- places(state = "CA") |>
  clean_names()

# retrieve Los Angeles county fro ca_counties
la <- ca |>
  filter(namelsad == "Los Angeles city")

# check crs of LA county
st_crs(la) # NAD 1983

# change crs to match EJ SCREEN data
la_reproj <- st_transform(la, crs = st_crs(ej_screen_la))

#check that they match
st_crs(la_reproj) == st_crs(ej_screen_la)

# plot LA county
tm_shape(la_reproj)+
  tm_polygons()+
  tm_shape(redlining_reproj)+
  tm_fill(fill = "grade")
```

### Redlining in Los Angeles

```{r}
# redlining data from HOLC 
redlining <- st_read(here("data", "mapping-inequality","mapping-inequality-los-angeles.json"))

# check CRS
st_crs(redlining)

# check crs of ej data and redlining data
st_crs(ej_screen_la) == st_crs(redlining) #false

# reproject to match LA block groups from EJ Screen data
redlining_reproj <- st_transform(redlining, crs = st_crs(ej_screen_la))

# check to see that it matches 
st_crs(redlining_reproj) == st_crs(ej_screen_la) 

# create map of redlining in LA county
tm_shape(ej_screen_la)+
  tm_polygons()+
tm_shape(redlining_reproj)+
  tm_polygons(fill = "red")


# Plot to verify
tm_shape(ej_screen_clip) +
  tm_polygons() +
tm_shape(redlining_reproj) +
  tm_fill(fill= "grade")

  
```

### Birds in Los Angeles County

```{r}
# read in bird data
birds <- st_read(here("data", "gbif-birds-LA",
                      "gbif-birds-LA.shp"))
```

## Historical Redlining Map

```{r}

```
